@import models.view.BreadcrumbView
@import play.twirl.api.HtmlFormat
@import views.html.frontendComponents.controlCodeBreadcrumbs._
@import views.html.triage.outcomePage
@import views.html.common.state.contextFormParams
@import views.html.common.form.formCheckbox
@import com.google.common.collect.Iterables
@import views.html.common.page._

@this()
@(form: Form[_], stageId: String, sessionId: String, breadcrumbView: BreadcrumbView, controlCodes: List[String])

@outcomePage("Item not listed", sessionId) {

  @twoThirdsColumn{
    @errorSummary(form)
  }

  <p class="lede">
    Based on the answers you've provided, your item is not included on the UK Strategic Export Control Lists.
  </p>

  @controlCodeBreadcrumbs(isWide = true) {
    @for(breadcrumbItemView <- breadcrumbView.getBreadcrumbItemViews) {
      @controlCodeBreadcrumbsStep(breadcrumbItemView.getUrl) {
        @breadcrumbItemView.getText
        @if(breadcrumbItemView.getDescription!=null) {
          @breadcrumbItemView.getDescription
        }
        @if(!breadcrumbItemView.getNoteViews.isEmpty) {
          @controlCodeBreadcrumbsDetailBox()(HtmlFormat.empty) {
            @controlCodeBreadcrumbsNotes() {
              @for(noteView <- breadcrumbItemView.getNoteViews) {
                <li>@noteView.getText</li>
              }
            }
          }
        }
      }
    }
    @controlCodeBreadcrumbsDetailBox(isPathStep = true) {
      <span class="font-medium">Item is decontrolled</span>
        <p></p>
        @Iterables.getLast(breadcrumbView.getBreadcrumbItemViews).getText
        @if(Iterables.getLast(breadcrumbView.getBreadcrumbItemViews).getDescription!=null) {
          @Iterables.getLast(breadcrumbView.getBreadcrumbItemViews).getDescription
        }
        <p></p>
        @for(controlCode <- controlCodes) {
         - @controlCode.<br>
        }
    }(HtmlFormat.empty)
  }

  <h2 class="heading-large">What you should do next</h2>

  <ol class="circle-step-list">
    <li>
      If you have not consulted the relevant item design margins and/or a technical officer with the appropriate
      knowledge, we advise you do so before requesting a No Licence Required (NLR) document or proceeding past this page.
    </li>
    <li>
      Even if if your item is not controlled it may still be affected by end use controls and any
      <a href="https://www.gov.uk/guidance/sanctions-embargoes-and-restrictions" rel="external" target="_blank">
        sanctions and embargoes<span class="visually-hidden"> (opens in a new tab)</span>
      </a>.
      Refer to the
      <a href="#" rel="external" target="_blank">
        end user advisory service (LINK TO BE UPDATED)<span class="visually-hidden"> (opens in a new tab)</span>
      </a>
      to understand whether your item may need a licence.
    </li>
    <li>
      You may request an NLR document if, following the points above, you believe that your item is still not subject
      to controls.
    </li>
  </ol>

  <div class="banner danger-banner">
    <span class="visually-hidden">Warning:</span>
    If you export your item without a licence, you will be responsible for any penalties should a licence be required.
  </div>

  <form action="@routes.StageController.handleOutcomeDecontrolSubmit(stageId, sessionId)" method="POST">
    @contextFormParams()

    <div class="form-group">
      @formCheckbox(form("answer"), "I confirm that I have read and understood all the information detailed above.")
    </div>

    <button type="submit" class="button" name="action" value="continue">Request an NLR document</button>
  </form>

}
